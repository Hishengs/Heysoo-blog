<div class="pieces">
<foreach name="pieces" item="piece">
<div class="piece" id="{$piece['id']}">
<div class="piece_left">
<div class="essay_date">
<div class="date_y">{:date("Y",strtotime($piece['date']))}</div>
<div class="date_md">{:date("m/d",strtotime($piece['date']))}</div>
</div>
</div>
<div class="piece_right">
<div class="bg"></div><div class="piece_triangle"></div>
<div class="piece_info">
<span class="piece_author">{$piece.username} &nbsp; &nbsp;</span>
<span class="piece_date"> <i class="icon-time" title="发布时间"></i> {:date("Y-m-d",strtotime($piece['date']))}</span>
</div>
<div class="piece_content">
{$piece.content}
</div>
<div class="piece_footer"><i class="icon-tag"></i>  
<assign name="tags" value="$piece['tag']" /> 
<foreach name="tags" item="tag" >
<a href="javascript:tag('{$tag}');" class="tag" style="text-decoration:none;">{$tag}</a>&nbsp;
</foreach>
<if condition="$piece['visible'] eq 0">
  <i class="icon-eye-close" title="私密"></i>
</if>
 <span class="piece_operation">
 <i class="icon-remove piece-remove" title="删除，请谨慎" onclick="javascript:deleteItem('piece',{$piece['id']});"></i>
 </span>
</div>
</div>
</div>
</foreach>
</div>
<!-- <button class="hs-btn hs-btn-primary hs-btn-block load_more"><i class="icon-arrow-down"></i> 加载更多</button> -->

<div id="piece_pagination" class="pagination">
</div>
<if condition="$totalCount gt 1">
<script type="text/javascript">
	$('#piece_pagination').jqPaginator({
		prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
		next: '<li class="next"><a href="javascript:;">下一页</a></li>',
		page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
		first: '<li class="first"><a href="javascript:;">首页</a></li>',
		last: '<li class="last"><a href="javascript:;">末页</a></li>',
	    totalPages: {$totalPage},
	    totalCounts:{$totalCount},
	    pageSize:{$pageSize},
	    visiblePages: 7,
	    currentPage: 1,
	    onPageChange: function (num, type) {
	        $.ajax({
	        	url:controller_path+"Piece/load_pieces_html.html",
				type:'GET',
				data:{'page':num-1,'type':type},
				dataType:'json',
				success:function(data){
					if(data.error == 0){
						$(".pieces").empty();
						$(".pieces").html(data.html);
						$(document).scrollTop(0);
					}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					console.log(XMLHttpRequest);
				}
	        });
	    }
	});
</script>
</if>